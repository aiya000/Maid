ã€€
## ã€Œã—ã‚“ã•ã‚“ãã¼ã†ã€
## GHCã®derivingãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼
ã€€
### ğŸ¤ŸğŸ™„ğŸ¤Ÿ aiya000
### https://bit.ly/2MuMofR

- - - - -

## åƒ•

<div class="profile">
    <div class="left">
        ![profile-image](profile.png)
    </div>
    <div class="right">
        <ul>
            <li>åå‰: aiya000 (ã‚ã„ã‚„)</li>
            <li>åœè«–ã‚’ã¡ã‚‡ã£ã¨ã ã‘</li>
            <li>æ¨ã—ã‚¨ãƒ‡ã‚£ã‚¿: Vim</li>
        </ul>
    </div>
</div>

<aside class="notes">
åå‰ã‚’ã€Œã‚ã„ã‚„ãœã‚ãœã‚ãœã‚ã€ã¨ç”³ã—ã¾ã™ã€‚
æ™®æ®µã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ã‹ã€ã‚ã¨ã¯å°‘ã—ã ã‘åœè«–ã‚’ã‚„ã£ã¦ã„ã¦ã€æ•°å­¦åœè«–å…¥é–€æœ¬ã¿ãŸã„ãªã®ã‚’é ’å¸ƒã—ãŸã‚Šã—ã¦ã¾ã™ã€‚

åƒ•ã®ã¡ã‚‡ã£ã¨ã—ãŸè¿‘æ³ãªã®ã§ã™ãŒâ€¦â€¦

ã‚‚ã¨ã‚‚ã¨ã€ã„ã‚ã‚†ã‚‹åœ°å£°ãŒå‡ºã›ãªãã¦ã€æ™®æ®µã‹ã‚‰ã“ã®è£å£°ã§è©±ã—ã¦ã‚‹ã‚“ã§ã™ã‚ˆã€‚

ãã‚Œã§æœ€è¿‘ã¯VTuberã«ãªã‚ŠãŸãã¦ã€
ãƒœã‚¤ã‚¹ãƒã‚§ãƒ³ã‚¸ãƒ£ãƒ¼ã«é ¼ã‚‰ãªã„ã§ã€
å˜ãªã‚‹è£å£°ã˜ã‚ƒãªãã¦å¯æ„›ã„å¥³ã®å­ã®å£°ã‚’å‡ºã›ã‚‹ã‚ˆã†ã«ãªã‚ŠãŸã„ãªã€œã€œã¨æ€ã£ã¦ã€
ç·´ç¿’ã—ã¦ãŸã‚“ã§ã™ã€‚

ãã—ãŸã‚‰ã“ã‚“ãªã€åœ°å£°ãŒå‡ºã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

â€¦â€¦ã§ã¯è‡ªå·±ç´¹ä»‹ã¯ã“ã“ã¾ã§ã«ã—ã¦ã€æ¬¡ã«ã„ãã¾ã—ã‚‡ã†ã€‚

ã¾ãšã“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§æœ€åˆã«å­¦ã¶ã“ã¨ã¯â€¦â€¦ ->
</aside>

- - - - -

ã—ã‚“ã•ã‚“-ãã¼ã†ã€ç¥ç®—é¬¼è¬€ã€‘

ã€€

äººçŸ¥ã®åŠã°ãªã„ã‚ˆã†ãªã€  
ã™ãã‚ŒãŸå·§ã¿ãªç­–ç•¥ã®ã“ã¨ã€‚

<aside class="notes">
ã“ã‚Œã§ã™ã€‚

çš†ã•ã‚“ã€Œã—ã‚“ã•ã‚“ãã¼ã†ã£ã¦ä½•ï¼Ÿã€ã£ã¦æ„Ÿã˜ã ã¨æ€ã†ã®ã§ã€æ°—ã«ãªã‚‹ã¨ã“ã‚ã‚’ã¯ã£ãã‚Šã•ã›ã¦ãŠãã¾ã—ã‚‡ã†ï¼

ç¥ç®—é¬¼è¬€ã¨ã¯
ã€ŒäººçŸ¥ã®åŠã°ãªã„ã‚ˆã†ãªã€ã™ãã‚ŒãŸå·§ã¿ãªç­–ç•¥ã®ã“ã¨ã€‚ã€
ã§ã™ã€‚

ãã‚Œã ã‘GHC Haskellã®derivingã¯ã€ã™ã”ãè³¢ããªã£ã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚
</aside>

- - - - -

## ä»Šå›ã®å†…å®¹

- - - - -

## GHCã®æä¾›ã™ã‚‹
## derivingæ©Ÿèƒ½ã®å…¨ä½“åƒ

- - - - -

### GHCã®æä¾›ã™ã‚‹derivingãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã®å…¨ä½“åƒ - ä»Šå›ã®å†…å®¹

ã€4ç¨®é¡ã€ã®å„derivingæ©Ÿæ§‹ã®ç´¹ä»‹ + Î±

- Haskellæ¨™æº–ã®deriving
- `GeneralizedNewtypeDeriving`
- `DeriveAnyClass`
- `DerivingVia`

- - - - -

## ãã‚‚ãã‚‚derivingã¨ã¯

- - - - -

## Haskellæ¨™æº–

- - - - -

### Haskellæ¨™æº– - ãã‚‚ãã‚‚derivingã¨ã¯

```haskell
data Direction = Left | Right | Up | Down
  deriving (Eq, Show, Enum, Bounded)
```

<div class="twin">
    <div class="pane vertical-center">
        <div>é–¢æ•°ã‚’è‡ªå‹•ã§</div>
        <div>å®šç¾©ã—ã¦ãã‚Œã‚‹ã‚„ã¤</div>
        <div>ã€€</div>
        <div>ç‰¹å®šã®å‹ã‚¯ãƒ©ã‚¹ã®ã¿ã«å¯¾ã—ã¦</div>
        <div>ã—ã‹ä½¿ãˆãªã„</div>
        <div>Eqãƒ»Showãƒ»Enumãƒ»...ãƒ»~~Read~~</div>
    </div>

    >>> Left == Left
    True

    >>> [Right .. Down]
    [Right,Up,Down]

    >>> maxBound  :: Direction
    Down

    >>> minBound :: Direction
    Left
</div>

- - - - -

## GHCæ‹¡å¼µã®deriving

- - - - -

:point_down: ä»Šå›ã®ä¸»é¡Œ

## GHCæ‹¡å¼µã®deriving

- - - - -

### GHCæ‹¡å¼µã®deriving - ä»Šå›ã®ä¸»é¡Œ

æ–°ã—ã„3ã¤ã®derivingæ–¹æ³•

- `GeneralizedNewtypeDeriving`
- `DeriveAnyClass`
- `DerivingVia`

- - - - -

## GeneralizedNewtypeDeriving

- - - - -

### GeneralizedNewtypeDeriving - GHCæ‹¡å¼µã®deriving

ã€Œã©ã†ã„ã†æ„å‘³ï¼Ÿã€

- Generalized
    - ã€Œä¸€èˆ¬åŒ–ã•ã‚ŒãŸã€ï¼ˆæ±ç”¨çš„ãªï¼‰
- NewtypeDeriving
    - ã€Œ`newtype`ç”¨ã®`deriving`ã€

- - - - -

### GeneralizedNewtypeDeriving - GHCæ‹¡å¼µã®deriving

ã€Œã©ã†ã„ã†ã‚‚ã®ï¼Ÿã€

newtypeã®å…ƒã«ãªã‚‹å‹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ã€ãã®newtypeã§åˆ©ç”¨ã™ã‚‹æ©Ÿèƒ½ã€‚

ãŸã¾ã«ã€ŒGNDã€ã¨ã‹ç•¥ã•ã‚Œã‚‹ã€‚

- - - - -

### GeneralizedNewtypeDeriving - GHCæ‹¡å¼µã®deriving

```haskell
data Nat = Zero | Succ Nat
  deriving (Show)

class Numeric a where
  toNumber :: a -> Int

instance Numeric Nat where
  toNumber Zero     = 0
  toNumber (Succ x) = 1 + toNumber x
```

```haskell
{-# LANGUAGE GeneralizedNewtypeDeriving #-}

newtype NonNegative = NonNegative Nat
  deriving (Numeric)  -- GeneralizedNewtypeDerivingã®æ©Ÿèƒ½
```

<aside class="notes">
- æ¨™æº–ã§ã¯ã“ã®ã€è‡ªå‰ã§å®šç¾©ã—ãŸNumericã‚¯ãƒ©ã‚¹ã¨ã„ã†ã®ã¯derivingã§ãã¾ã›ã‚“  
- GeneralizedNewtypeDerivingã®ãŠã‹ã’ã§derivingã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™  
-  Natã‚¯ãƒ©ã‚¹ã®Numericã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ã€NonNegativeã«ã‚³ãƒ”ãƒ¼ã—ã¦ãã®ã¾ã¾ä½¿ã†ã‚¤ãƒ¡ãƒ¼ã‚¸  
</aside>

- - - - -

### GeneralizedNewtypeDeriving - GHCæ‹¡å¼µã®deriving

Nat

```
>>> toNumber Zero
0
>>> toNumber $ Succ (Succ Zero)
2
```

**NonNegative**

```
>>> toNumber $ NonNegative Zero
0
>>> toNumber $ NonNegative (Succ (Succ Zero))
2
```

- - - - -

### GeneralizedNewtypeDeriving - GHCæ‹¡å¼µã®deriving

MonadTransã®æ§‹ç¯‰ã«ã‚ˆãä½¿ã‚ã‚Œã‚‹

```haskell
-- ãƒ¬ã‚­ã‚µãƒ¼ã®ãŸã‚ã®å‹ã€‚
-- ã‚¨ãƒ©ãƒ¼å ±å‘ŠãŒã§ãã¦ã€ç¾åœ¨å‡¦ç†ä¸­ã®ãƒˆãƒ¼ã‚¯ãƒ³ä½ç½®ã‚’çŠ¶æ…‹ã«æŒã£ã¦ã„ã‚‹ã€‚
newtype Processor a = Processor
  { unProcessor :: ExceptT Failure (State TokenPos) a
  } deriving ( Functor, Applicative, Monad
             , MonadState TokenPos
             , MonadError Failure
             )
-- ã“ã‚Œã‚‰å…¨éƒ¨ã€GeneralizedNewtypeDerivingã«ã‚ˆã‚‹
-- Monad m => ExceptT e mã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
```

<div class="unimportant">
ä¸»é¡Œã¨é–¢ä¿‚ãªã„ã®ã§ã€è©³ã—ãã¯ç†è§£ã§ããªãã¦ã‚ˆã„ï¼
ã¨ã‚Šã‚ãˆãšã€Œä¾¿åˆ©ã€ã€‚
</div>

- - - - -

## DeriveAnyClass

- - - - -

### DeriveAnyClass - GHCæ‹¡å¼µã®deriving

'minimal implementation'ãŒç©ºé›†åˆã§ã‚ã‚‹ã‚¯ãƒ©ã‚¹ã‚’derivingæŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹æ©Ÿèƒ½ã€‚

```haskell
-- å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹é–¢æ•°ãŒãªã„
--      = 'minimal implementation'ãŒç©ºé›†åˆ
class Visible a where
  visualize :: a -> String
  visualize = const "not specified"  -- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®Ÿè£…

data Anonymous = Anonymous

-- visualize ã‚’å®Ÿè£…ã—ãªãã¦ã‚‚ instance å®£è¨€ã§ãã‚‹
--      ==> DeriveAnyClass ãŒä½¿ãˆã‚‹ï¼
instance Visible Anonymous
```

```
>>> visualize Anonymous
"not specified"
```

- - - - -

### DeriveAnyClass - GHCæ‹¡å¼µã®deriving

`DeriveAnyClass`ã‚’ä½¿ã†ã¨

```haskell
{-# LANGUAGE DeriveAnyClass #-}

data Anonymous = Anonymous
  deriving (Visible)  -- ã“ã†æ›¸ã‘ã‚‹
```

```
>>> visualize Anonymous
"not specified"
```

- - - - -

### DeriveAnyClass - GHCæ‹¡å¼µã®deriving

ã€Œã©ã®ã‚ˆã†ãªã‚¯ãƒ©ã‚¹ã§ã‚‚derivingã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹æœ€å¼·ã®ã‚„ã¹ãƒ¼ã‚„ã¤ã€
**ã§ã¯ãªã„**

- - - - -

## DerivingVia

- - - - -

:point_down: åƒ•ã®ã‚ã¡ã‚ƒæ¨ã—GHCæ‹¡å¼µ

## DerivingVia

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

ã€Œãªã«ãã‚Œï¼Ÿã€

<div class="unimportant">ã€€</div>

`GeneralizedNewtypeDeriving` ã‚’  
**ã‚‚ã£ã¨ä¸€èˆ¬åŒ–ã—ãŸ**ã€ã™ã’ãƒ¼ã‚„ã¤ï¼

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

<!--

```haskell
data Nat = Zero | Succ Nat
  deriving (Show)

class Numeric a where
  toNumber :: a -> Int

instance Numeric Nat where
  toNumber Zero     = 0
  toNumber (Succ x) = 1 + toNumber x
```

-->

Negative: 0 ã¨ è² æ•°

```haskell
-- Numeric, Nat, instance Numeric Nat
--    â†‘ ã•ã£ãã§ã¦ããŸã‚„ã¤

newtype Negative = Negative Nat

instance Numeric Negative where
  toNumber (Negative x) = negate $ toNumber x
```

```
>>> toNumber . Negative $ Succ (Succ Zero)
-2
>>> toNumber . Negative $ Zero
0
```

<aside class="notes">
- ã‚‚ã†ã¡ã‚‡ã£ã¨ã€æ•°ã®ç¨®é¡ã‚’å¢—ã‚„ã—ã¦ã¿ã‚‹
</aside>

- - - - -

ã¡ã‚‡ã£ã¨è€ƒãˆã¦ã¿ã‚‹

ã€€

:thinking_face: oO( Negativeã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã€  
                    ã€€ã€€ã€€`instance Numeric Nat`ãª  
                    ã€€ã€€ã€€ã€€ã€€newtypeã‚’ä½œã‚Œãªã„ã‹ãªâ€¦â€¦ï¼Ÿ )

<div class="unimportant">
â€» ã“ã“ã§ã€Œãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹ã€ã¨ã¯ã€ TODO
</div>

- - - - -

ã‚„ã£ã¦ã¿ã‚‹

```haskell
{-# LANGUAGE GeneralizedNewtypeDeriving #-}
-- ï¼Ÿï¼Ÿï¼Ÿ
newtype Positive' = Positive' Negative
  deriving (Numeric)
```

```haskell
-- çµæœã€Œ2ã€ãŒæ¬²ã—ã‹ã£ãŸã®ã ã‘ã©â€¦â€¦
>>> toNumber . Positive' . Negative  $ Succ (Succ Zero)
-2
```

ã€€

ã†ã‚“ã€ã“ã‚Œã€`instance Numeric Negative`ã‚„ã­ã€‚
<div class="unimportant">
ï¼ˆãã‚Œã¯ãã†ï¼‰
</div>

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

<!-- {{{

```haskell
data Nat = Zero | Succ Nat
  deriving (Show)

class Numeric a where
  toNumber :: a -> Int

instance Numeric Nat where
  toNumber Zero     = 0
  toNumber (Succ x) = 1 + toNumber x

newtype Negative = Negative Nat

instance Numeric Negative where
  toNumber (Negative x) = negate $ toNumber x
```

}}} -->

:point_right: ãã“ã§ `DerivingVia`

```haskell
newtype Positive = Positive Negative
  deriving (Numeric) via Nat
```

```
>>> toNumber . Positive . Negative $ Succ (Succ Zero)
2
>>> toNumber . Positive . Negative $ Zero
0
```

ã‚ªãƒ¼ã‚±ãƒ¼ï¼ï¼ï¼

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

```haskell
newtype Positive = Positive Negative
  deriving (Numeric) via Nat
```

`via Nat`ï¼Ÿ

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

ãƒ™ãƒ¼ã‚¹ã®ãƒ„ãƒªãƒ¼ :point_down:

```
Nat                      -- `instance Numeric Nat`
|- NonNegative Nat       -- `deriving Numeric` (GND)
|- Negative Nat          -- `instance Numeric Negative`
   |- Positive Negative  -- `deriving Numeric via Nat` (via)
```

Positiveã®ãƒ™ãƒ¼ã‚¹ã«ã¯**Negative**ã¨**Nat**ãŒå­˜åœ¨ã—ã€  
ãã‚Œã‚‰ã¯ã©ã¡ã‚‰ã‚‚**Numericã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**ã§ã‚ã‚‹ã€‚

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

==> Positiveã¯ :point_down: ã®ã©ã¡ã‚‰ã‚‚ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚‚`deriving`ã™ã‚‹ã“ã¨ãŒã§ãã‚‹

- `instance Numeric Nat`
- `instance Numeric Negative`

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

GNDã€Œã©ã£ã¡ã‚’derivingã—ã¦ã‚‚ã‚ˆã„ãªã‚‰ã€  
ã€€ã€€ã€€ã€€**ç›´è¿‘ã®**Negativeã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’é¸ã¶ã­ã€

<div class="unimportant">ã€€</div>

Positive'ã€Œã‚ˆã‚ã—ã‚ƒã™ã€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€  

Positive' oOï¼ˆã‚“ã€GNDã€ä»Šãªã«ã‹è¨€ã£ã¦ãŸï¼Ÿ  
ã€€ã€€ã€€ã€€ã¾ã‚ã„ã£ã‹ï¼‰

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

Positive'ã€Œã§ãã¦ãªã„ã‚„ã‚“ï¼ï¼ï¼ã€

```haskell
>>> toNumber . Positive' . Negative  $ Succ (Succ Zero)
-2
```

GNDã€Œãã†è¨€ã£ãŸã‚„ã‚“ï¼ï¼ï¼ã€

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

<div class="small">
ä¸€æ–¹DerivingViaã¨Positiveã¯â€¦â€¦
</div>

<div class="unimportant">ã€€</div>

DerivingViaã€Œã©ã¡ã‚‰ã‚‚derivingã§ãã¾ã™ãŒã€  
ã€€ã€€ã©ã¡ã‚‰ã«ã—ã¾ã™ã‹ï¼Ÿã€

- `via Nat`
- `via Negative`

<div class="unimportant">ã€€</div>

Positiveã€Œ`via Nat`ã§ãŠé¡˜ã„ã—ã¾ã™ã€ã€€ã€€

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

```
>>> toNumber . Positive . Negative $ Succ (Succ Zero)
2
>>> toNumber . Positive . Negative $ Zero
0
```

DerivingViaã€Œ ğŸ‘ ã€

Positiveã€Œ ğŸ‘ ã€ã€€

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

ã¾ã¨ã‚ã‚‹ã¨

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

Positiveã®**GND**ãŒé¸ã¹ã‚‹Numericã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

```
Nat                      --
|- NonNegative Nat       --
|- Negative Nat          -- ğŸ‘ˆ ã“ã“ã ã‘
   |- Positive Negative  --
```

**ç›´è¿‘ã®ã¿**

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

Positiveã®**DerivingVia**ãŒé¸ã¹ã‚‹Numericã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

```
Nat                      -- ğŸ‘ˆ
|- NonNegative Nat       --
|- Negative Nat          -- ğŸ‘ˆ
   |- Positive Negative  --
```

ãƒ™ãƒ¼ã‚¹ã«ãªã£ã¦ã„ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’**ã©ã‚Œã§ã‚‚**

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

ãã‚Œã ã‘ï¼Ÿ

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

ã¾ã ã‚ã‚‹ã‚ˆ

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

<!-- {{{

```haskell
data Nat = Zero | Succ Nat
  deriving (Show)

class Numeric a where
  toNumber :: a -> Int

instance Numeric Nat where
  toNumber Zero     = 0
  toNumber (Succ x) = 1 + toNumber x

newtype Negative = Negative Nat

instance Numeric Negative where
  toNumber (Negative x) = negate $ toNumber x

newtype NonNegative = NonNegative Nat
  deriving newtype (Numeric)
```

}}} -->

<div class="small">
åƒ•ã€Œã‚„ã£ã±ã‚ŠNegativeãŒPositiveã®ãƒ™ãƒ¼ã‚¹ã«ã€€ã€€ã€€ã€€  
ã€€ã€€ã€€ã€€ãªã£ã¦ã„ã‚‹ã®ã¯ãŠã‹ã—ã„ã€‚NatãŒé©åˆ‡ã£ã½ã„ã€
</div>

<div class="small">
åƒ•ã€Œã‚ã¨Positiveã¯NonNegativeã®ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€  
ã€€ã€€ã€€ã€€Numericã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ã†ã¨ã‚ˆã•ãã†ã€
</div>

<div class="small">ã€€</div>

```haskell
newtype Positive = Positive Negative
  deriving (Numeric) via Nat
```

ğŸ‘‡ ãƒ™ãƒ¼ã‚¹ã¨viaå…ƒã‚’å¤‰æ›´

```haskell
newtype Positive = Positive Nat
  deriving (Numeric) via NonNegative
```

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

```
>>> toNumber . Positive $ Succ (Succ Zero)
2
>>> toNumber . Positive $ Zero
0
```

ã¡ã‚ƒã‚“ã¨NonNegativeã®Numberã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨åŒã˜å‹•ãã‚’ã—ã¦ã„ã‚‹

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

ã‚ã‚Œã€ã§ã‚‚ã€Positiveã®ãƒ™ãƒ¼ã‚¹ã«NonNegativeã¯ãªã„ã‚ˆï¼Ÿï¼Ÿ

```haskell
Nat
|- NonNegative Nat
|- Negative Nat
|- Positive Nat
```

ã„ã„ã®ï¼Ÿ

- - - - -

DerivingViaã€Œã„ã„ã‚ˆã€

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

- <span class="small">GNDã§ã¯ãƒ™ãƒ¼ã‚¹ã®é–¢ä¿‚ã«ãªã£ã¦ã„ãªã„ã¨derivingã§ããªã‹ã£ãŸ</span>
- <span class="small">DerivingViaã§ã¯åŒã˜å‹ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã‚Œã°ã‚ªãƒ¼ã‚±ãƒ¼</span> **â€»**

```haskell
Nat
|- NonNegative Nat
|- Negative Nat
|- Positive Nat
```

<div class="unimportant">
**â€»** ã€ŒrepresentationãŒåŒã˜ã§ã‚ã‚Œã°ã‚ªãƒ¼ã‚±ãƒ¼ã€ã®æ„
</div>

<aside class="notes">
- ã€Œrepresentationã¨ã¯ï¼Ÿã€ã£ã¦ã„ã†ã®ã¯ã“ã®ç™ºè¡¨ã®ç¯„å›²ã‚’è¶…ãˆã¦ã—ã¾ã†ã®ã§ã€ã‚„ã‚Šã¾ã›ã‚“
- å¤§ã¾ã‹ã«è¨€ã£ã¦ã€ŒåŒã˜å‹ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã‚Œã°ã‚ªãƒ¼ã‚±ãƒ¼ã€ã¨ã¯è¨€ãˆã¾ã™
</aside>

- - - - -

### DerivingVia - GHCæ‹¡å¼µã®deriving

- ãã®ä»–æ©Ÿèƒ½
    - newtypeä»¥å¤–ã«ã€dataã«å¯¾ã—ã¦ã‚‚ä½¿ãˆã‚‹

- - - - -

ï½– ï½– ï½– ï½– ï½– ï½– ï½– ï½– ï½– ï½– ï½– ï½– ï½– ï½– ï½–

ï¼ã€€ã€€DerivingViaã€Œã€€ã€€â™¥ğŸ¤—â™¥ã€€ã€€ã€ã€€ã€€ï¼œ

ï¼¾ ï¼¾ ï¼¾ ï¼¾ ï¼¾ ï¼¾ ï¼¾ ï¼¾ ï¼¾ ï¼¾ ï¼¾ ï¼¾ ï¼¾ ï¼¾ ï¼¾

- - - - -

# ãŠã¾ã‘

- - - - -

### derivingæ–¹æ³•ï¼ˆå…¨ç¨®é¡ï¼‰ - ãŠã¾ã‘

å‹ã‚¯ãƒ©ã‚¹ã‚’derivingã™ã‚‹æ–¹æ³•ãŒã€Œ4ç¨®é¡ã€ã‚ã‚‹

- Haskellæ¨™æº–ã®deriving
- `DeriveAnyClass`
- `GeneralizedNewtypeDeriving`
- `DerivingVia`

- - - - -

# å¤šã„

- - - - -

### GHCæ‹¡å¼µã®deriving - ãŠã¾ã‘

ã‚ã‚‹å®Ÿè£…ãƒ‡ãƒ¼ã‚¿å‹`Two`ã®å®Ÿè£…

```haskell
class Numeric' a where
  toNumber' :: a -> Int
  toNumber' = const 10  -- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®Ÿè£…
```

```haskell
data One = One
instance Numeric' One where
  toNumber' One = 1  -- ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰å®Ÿè£…
```

```haskell
{-# LANGUAGE DeriveAnyClass #-}
{-# LANGUAGE GeneralizedNewtypeDeriving #-}
newtype Two = Two { pred :: One }
  deriving (Numeric')  -- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®Ÿè£…ã¨ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰å®Ÿè£…ã©ã£ã¡ï¼Ÿï¼Ÿ
```

- - - - -

Haskellã€Œã“ã®`deriving (Numeric')`ã€ã€€ã€€ã€€ã€€  
ã€€ã€€ã€€ã€€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®Ÿè£…ã¨ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰å®Ÿè£…ã€  
ã©ã£ã¡ä½¿ãˆã°ã„ã„ï¼Ÿï¼Ÿã€

GHCã€Œã€€ã€€ã€€ã€€ã€€ã‚ã‹ã‚‰ã‚“ã€€ã€€ã€€ã€€ã€€ã€ã€€ã€€ã€€

<div class="unimportant">ã€€</div>

```markdown
warning:
    â€¢ Both DeriveAnyClass and GeneralizedNewtypeDeriving are enabled
      Defaulting to the DeriveAnyClass strategy for instantiating Numeric'
    â€¢ In the newtype declaration for â€˜Twoâ€™
```

<div class="unimportant">ã€€</div>

<div class="unimportant">
æ„è¨³: `DeriveAnyClass`ãƒ»`GeneralizedNewtypeDeriving`  
ã©ã£ã¡ã‚‚é©ç”¨ã§ãã‚‹ã‘ã©ï¼Ÿ  
ã¨ã‚Šã‚ãˆãš `DeriveAnyClass` ã—ã¦ãŠãã­ã€‚
</div>

- - - - -

DerivingStrategiesã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€  
ã€Œã“ã„ã¤ã‚‰ã‚¢ã‚«ãƒ³ã€‚  
ã€€ã€€ã€€ã€€ãƒ¯ã‚¤ãŒã¾ã¨ã‚ãªãã‚ƒã€‚ã€

- - - - -

### DerivingStrategies - GHCã®æä¾›ã™ã‚‹derivingãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã®...

DerivingStrategiesã€Œã¾ãšã¯å„deriving**æˆ¦ç•¥**ã«  
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€åå‰ã‚’ã¤ã‘ã‚ˆã†ã€

- stock: <span class="small">Haskellæ¨™æº–ã®deriving</span>
- anyclass: <span class="small">`DeriveAnyClass`</span>
- newtype: <span class="small">`GeneralizedNewtypeDeriving`</span>
- via: <span class="small">`DerivingVia`</span>

- - - - -

### DerivingStrategies - GHCã®æä¾›ã™ã‚‹derivingãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã®...

<!-- {{{

```haskell
data Nat = Zero | Succ Nat
  deriving (Show)

class Numeric a where
  toNumber :: a -> Int

instance Numeric Nat where
  toNumber Zero     = 0
  toNumber (Succ x) = 1 + toNumber x

newtype Negative = Negative Nat

instance Numeric Negative where
  toNumber (Negative x) = negate $ toNumber x

newtype NonNegative = NonNegative Nat
  deriving newtype (Numeric)

class Visible a where
  visualize :: a -> String
  visualize = const "not specified"

data Anonymous = Anonymous
  deriving anyclass (Visible)
```

}}} -->

DerivingStrategiesã€Œæ§‹æ–‡ã‚’ã¤ã‘ã¦ã¿ã‚ˆã†ã€

```haskell
{-# LANGUAGE DerivingStrategies #-}
newtype SomeBody = SomeBody Person
  deriving       (Show)          -- æ¨™æº–
  deriving stock (Eq)            -- æ¨™æº–
  deriving anyclass (Visible)    -- DeriveAnyClass
  deriving newtype (Enum)        -- GeneralizedNewtypeDeriving
  deriving (Bounded) via Person  -- DerivingVia
```

```haskell
data Person = Eta | Mu
  deriving (Show, Eq, Enum, Bounded)
```

- - - - -

DerivingStrategiesã€Œã†ã‚“ã€ã§ãã¦ãã†ã€

```haskell
>>> eta = SomeBody Eta
>>> mu = SomeBody Mu

>>> show eta
"SomeBody Eta"
>>> eta /= mu
True
>>> visualize mu
"not specified"
>>> succ eta
SomeBody Mu
>>> maxBound :: SomeBody
SomeBody Mu
```

- - - - -

### DerivingStrategies - GHCã®æä¾›ã™ã‚‹derivingãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã®...

<!-- {{{

```haskell
class Numeric' a where
  toNumber' :: a -> Int
  toNumber' = const 10

data One = One

instance Numeric' One where
  toNumber' One = 1
```

}}} -->

DerivingStrategiesã€Œã•ã£ãã®å•é¡Œã‚’ã€€ã€€ã€€ã€€  
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€è§£æ±ºã—ã¦ã¿ã‚ˆã†ã€ã€€ã€€ã€€ã€€

- - - - -

ã€Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®Ÿè£…ã¨ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰å®Ÿè£…  
ã€€ã€€ã€€ã€€ã©ã£ã¡ï¼Ÿï¼Ÿã€

```haskell
{-# LANGUAGE DeriveAnyClass #-}
{-# LANGUAGE GeneralizedNewtypeDeriving #-}
newtype Two = Two { pred :: One }
  deriving (Numeric')  -- ã€Œã©ã£ã¡ï¼Ÿï¼Ÿã€
```

```haskell
class Numeric' a where
  toNumber' :: a -> Int
  toNumber' = const 10  -- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®Ÿè£…
```

```haskell
data One = One
instance Numeric' One where
  toNumber' One = 1  -- ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰å®Ÿè£…
```

- - - - -

### DerivingStrategies - GHCã®æä¾›ã™ã‚‹derivingãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã®...

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®Ÿè£…ã‚’ä½¿ã†ãªã‚‰

```haskell
newtype Two = Two { pred :: One }
  deriving anyclass (Numeric')
```

```haskell
>>> toNumber' $ Two One
10
```

- - - - -

### DerivingStrategies - GHCã®æä¾›ã™ã‚‹derivingãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã®...

ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰å®Ÿè£…ã‚’ä½¿ã†ãªã‚‰ï¼ˆ`GND`ï¼‰

```haskell
newtype Two' = Two' { pred' :: One }
  deriving newtype (Numeric')
```

```haskell
>>> toNumber' $ Two' One
1
```

- - - - -

### DerivingStrategies - GHCã®æä¾›ã™ã‚‹derivingãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã®...

ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰å®Ÿè£…ã‚’ä½¿ã†ãªã‚‰ï¼ˆ`DerivingVia`ï¼‰

```haskell
newtype Two'' = Two'' { pred'' :: One }
  deriving (Numeric') via One
```

```haskell
>>> toNumber' $ Two'' One
1
```

- - - - -

### DerivingStrategies - GHCã®æä¾›ã™ã‚‹derivingãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã®...

ã„ãšã‚Œã‚‚ãƒ‡ãƒ¼ã‚¿å®šç¾©å¥ã¯å¤‰ã‚ã‚‰ãªã„

```haskell
newtype Two   = Two   { pred   :: One }
newtype Two'  = Two'  { pred'  :: One }
newtype Two'' = Two'' { pred'' :: One }
```

å¤‰ã‚ã£ãŸã®ã¯**derivingå¥**ã ã‘

```haskell
deriving anyclass (Numeric')
deriving newtype (Numeric')
deriving (Numeric') via One
```

- - - - -

ã“ã‚ŒãŒ **newtype** ã®ãƒã‚«ãƒ©ã ï¼ï¼ï¼ï¼

- - - - -

# ãŠã‚ã‚Š
